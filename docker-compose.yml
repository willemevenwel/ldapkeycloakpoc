version: '3.8'
services:
  ldap:
    image: quay.io/minio/openldap:latest
    container_name: ldap
    environment:
      - LDAP_ORGANISATION=My Company
      - LDAP_DOMAIN=min.io
      - LDAP_BASE_DN=dc=min,dc=io
      - LDAP_ADMIN_PASSWORD=admin
    ports:
      - "389:389"
      - "636:636"
    volumes:
      - ldap_data:/var/lib/ldap
      - ldap_config:/etc/ldap/slapd.d

  ldap-manager:
    build: ./ldap-user-manager
    image: my-ldap-user-manager:latest
    container_name: ldap-manager
    environment:
      - LDAP_URI=ldap://ldap:389
      - LDAP_BASE_DN=dc=min,dc=io
      - LDAP_USER_OU=users
      - LDAP_GROUP_OU=groups
      - LDAP_REQUIRE_STARTTLS=FALSE
      - LDAP_ADMINS_GROUP=admins
      - LDAP_ADMIN_BIND_DN=cn=admin,dc=min,dc=io
      - LDAP_ADMIN_BIND_PWD=admin
      - NO_HTTPS=true
      - ENFORCE_SAFE_SYSTEM_NAMES=FALSE
    ports:
      - "8080:80"
    depends_on:
      - ldap

  keycloak:
    image: quay.io/keycloak/keycloak:latest
    container_name: keycloak
    command: start-dev
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    ports:
      - "8090:8080"

volumes:
  ldap_data:
  ldap_config:
